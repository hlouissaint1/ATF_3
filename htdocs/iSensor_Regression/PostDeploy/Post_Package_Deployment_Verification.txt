Documentation		# Test server functionality after package deployment

*** Settings ***
Resource                iSensorConfiguration.txt
Resource		post_deployment_keywords.txt
Resource                aws_ec2_instance.txt
Library                 SSHLibrary
Library                 OperatingSystem
Library                 BuiltIn
Library                 String
Library                 Collections
Library                 scwxCorelib.ATF         ${TestEnvironment}              ${ATF_User}
Library                 scwxCorelib.Mail        ${TestEnvironment}              ${ATF_User}
Library                 ctpapi2.PCSMS           ${TestEnvironment}              ${ATF_User}
Library                 scwxIMSClib.RCMS        ${TestEnvironment}              ${ATF_User}

Suite Setup             Setup iSensor Environment
Suite Teardown          Close Connections and Report Results


*** Variables ***
${category}                     balanced
${POLICY}                       1
${ISENSOR_IP}                   '10.238.129.126'


*** Test Case ***

Notify Start Of Test via Email
        Set Mail Subject                Starting Post Deployment Verification
        ${iSensor_Model}=               Execute Command                                         cat /HWTYPE |pcregrep -o 'R\\d{3}'
        Append Config                   iSensor Model: Dell ${iSensor_Model}
        Set Suite Variable              ${ISENSOR_MODEL}                                        ${iSensor_Model}
        ${resp}=                        Mail Report
        Log                             ${resp}
        Set Test Message                ${resp}

Verify Current State of Target iSensor
        Log                     Test is running in ${TestEnvironment}
        Validate and Log iSensor Configuration

Verify Rulesets Can Be Pushed To iSensor
	Push Rulesets To iSensor

Verify RCMSMQTransmit
	Execute an RCMSMQTransmit Command

Verify Shuns Can Be Added
	Add Shuns to iSensor

*** Keywords ***

Setup iSensor Environment
        Start EC2 Instance              ${ISENSOR_IP}
        Open SSH Connection


Stop iSensor EC2 Instance
        Stop EC2 Instance              ${ISENSOR_IP}


Close Connections and Report Results
#        Stop iSensor EC2 Instance
        Close All Connections
        Run Keyword If All Tests Passed        Email Test Has Passed
        Run Keyword If Any Tests Failed        Email Test Has Failed


Email Test Has Passed
        Set Mail Subject        Post package deployment test has PASSED                         catenate=True
        Append Config           iSensor Model: Dell ${ISENSOR_MODEL}
        Log To Mail             Test Report:            reportfile
        Log To Mail             Test Log:               logfile
        ${resp}=                Mail Report             attach=reportfile,logfile
        Log                     ${resp}


Email Test Has Failed
        Set Mail Subject        Post package deployment test has FAILED                         catenate=True
        Append Config           iSensor Model: Dell ${ISENSOR_MODEL}
        Log To Mail             Test Report:            reportfile
        Log To Mail             Test Log:               logfile
        ${resp}=                Mail Report             attach=reportfile,logfile
        Log                     ${resp}

